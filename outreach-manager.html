<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Outreach Manager PRO - Step2Dev</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --primary: #3b82f6;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --purple: #8b5cf6;
  --bg-main: #f8fafc;
  --bg-card: #ffffff;
  --bg-hover: #f1f5f9;
  --text-primary: #0f172a;
  --text-secondary: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 6px rgba(0,0,0,0.1);
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg-main);
  color: var(--text-primary);
  line-height: 1.6;
}

.app { display: flex; min-height: 100vh; }

/* Sidebar */
.sidebar {
  width: 280px;
  background: var(--bg-card);
  border-right: 1px solid var(--border);
  padding: 24px;
  position: fixed;
  height: 100vh;
  overflow-y: auto;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 32px;
  padding-bottom: 24px;
  border-bottom: 1px solid var(--border);
}

.logo-icon {
  width: 44px;
  height: 44px;
  background: linear-gradient(135deg, var(--primary), var(--purple));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  box-shadow: 0 4px 12px rgba(59,130,246,0.3);
}

.logo-text h1 {
  font-size: 20px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.logo-text p {
  font-size: 12px;
  color: var(--text-secondary);
  font-weight: 500;
}

.nav-item {
  padding: 12px 16px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  border: none;
  background: transparent;
  width: 100%;
  text-align: left;
  margin-bottom: 4px;
}

.nav-item:hover {
  background: var(--bg-hover);
  transform: translateX(4px);
}

.nav-item.active {
  background: linear-gradient(135deg, var(--primary), #2563eb);
  color: white;
  box-shadow: 0 4px 12px rgba(59,130,246,0.3);
}

.nav-badge {
  margin-left: auto;
  background: var(--danger);
  color: white;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 12px;
  min-width: 20px;
  text-align: center;
  font-weight: 700;
}

/* Main */
.main {
  flex: 1;
  margin-left: 280px;
  padding: 32px;
}

.page-header {
  margin-bottom: 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.page-title {
  font-size: 36px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.page-subtitle {
  font-size: 16px;
  color: var(--text-secondary);
  margin-top: 8px;
}

/* Filters */
.filters {
  background: var(--bg-card);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 24px;
  border: 1px solid var(--border);
}

.filters-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 16px;
}

.filter-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  display: block;
}

.quick-filters {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  padding-top: 16px;
  border-top: 1px solid var(--border);
}

.quick-btn {
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
}

.quick-btn:hover {
  border-color: var(--primary);
  color: var(--primary);
  transform: translateY(-2px);
}

.quick-btn.active {
  background: linear-gradient(135deg, var(--primary), #2563eb);
  border-color: var(--primary);
  color: white;
  box-shadow: 0 4px 12px rgba(59,130,246,0.3);
}

/* Stats */
.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin-bottom: 32px;
}

.stat-card {
  background: var(--bg-card);
  padding: 28px;
  border-radius: 16px;
  border: 1px solid var(--border);
  transition: all 0.3s;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(59,130,246,0.15);
}

.stat-value {
  font-size: 40px;
  font-weight: 800;
  margin-bottom: 8px;
}

.stat-label {
  font-size: 14px;
  color: var(--text-secondary);
  font-weight: 600;
}

/* Buttons */
.btn {
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.btn:hover { transform: translateY(-2px); box-shadow: var(--shadow); }

.btn-primary {
  background: linear-gradient(135deg, var(--primary), #2563eb);
  color: white;
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: white;
}

.btn-outline {
  background: var(--bg-card);
  color: var(--text-primary);
  border: 2px solid var(--border);
}

.btn-sm { padding: 8px 14px; font-size: 13px; }

/* Cards */
.card {
  background: var(--bg-card);
  border-radius: 16px;
  border: 1px solid var(--border);
  margin-bottom: 24px;
  overflow: hidden;
}

.card-header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(139,92,246,0.05));
}

.card-title {
  font-size: 20px;
  font-weight: 800;
}

.card-body { padding: 24px; }

/* Forms */
.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 14px;
  font-family: inherit;
  background: var(--bg-card);
  transition: all 0.2s;
  font-weight: 500;
}

.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(59,130,246,0.1);
}

/* Contact Cards */
.contact-card {
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 12px;
  background: var(--bg-hover);
  transition: all 0.2s;
}

.contact-card:hover {
  border-color: var(--primary);
  box-shadow: 0 4px 12px rgba(59,130,246,0.1);
}

.contact-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}

.contact-name {
  font-weight: 700;
  font-size: 15px;
}

.contact-email {
  font-size: 13px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.followup-schedule {
  margin-top: 12px;
  padding: 12px;
  background: white;
  border-radius: 8px;
  font-size: 12px;
}

.followup-item {
  display: inline-block;
  margin-right: 12px;
  margin-bottom: 4px;
  padding: 4px 10px;
  border-radius: 8px;
  font-weight: 600;
}

.fu-sent { background: #d1fae5; color: #065f46; }
.fu-due { background: #fef3c7; color: #92400e; }
.fu-scheduled { background: #e0e7ff; color: #4338ca; }

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.6);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
  backdrop-filter: blur(8px);
}

.modal.active { display: flex; }

.modal-content {
  background: var(--bg-card);
  border-radius: 20px;
  max-width: 900px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 25px 50px rgba(0,0,0,0.3);
}

.modal-header {
  padding: 28px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(135deg, rgba(59,130,246,0.05), rgba(139,92,246,0.05));
}

.modal-title {
  font-size: 24px;
  font-weight: 800;
}

.modal-body { padding: 28px; }

.modal-footer {
  padding: 24px 28px;
  border-top: 1px solid var(--border);
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 0 12px 24px rgba(0,0,0,0.3);
  display: none;
  z-index: 2000;
  font-weight: 600;
}

.toast.show { display: block; }
.toast.error { background: linear-gradient(135deg, var(--danger), #dc2626); }

/* Responsive */
@media (max-width: 768px) {
  .sidebar { transform: translateX(-100%); }
  .main { margin-left: 0; }
}
</style>
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">üöÄ</div>
      <div class="logo-text">
        <h1>Outreach PRO</h1>
        <p>by Step2Dev</p>
      </div>
    </div>

    <nav>
      <button class="nav-item active" onclick="switchView('dashboard')">
        üìä Dashboard
      </button>
      <button class="nav-item" onclick="switchView('all')">
        üë• All Prospects
        <span class="nav-badge" id="nav-all">0</span>
      </button>
      <button class="nav-item" onclick="switchView('fu1')">
        üì¨ Follow-up 1
        <span class="nav-badge" id="nav-fu1" style="background:#f59e0b">0</span>
      </button>
      <button class="nav-item" onclick="switchView('fu2')">
        üì´ Follow-up 2
        <span class="nav-badge" id="nav-fu2" style="background:#f97316">0</span>
      </button>
      <button class="nav-item" onclick="switchView('fu3')">
        üì™ Follow-up 3
        <span class="nav-badge" id="nav-fu3" style="background:#ef4444">0</span>
      </button>
      <button class="nav-item" onclick="switchView('templates')">
        üìù Templates
      </button>
      <button class="nav-item" onclick="switchView('settings')">
        ‚öôÔ∏è Settings
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <!-- Dashboard View -->
    <div id="view-dashboard" class="view">
      <div class="page-header">
        <div>
          <h1 class="page-title">Dashboard</h1>
          <p class="page-subtitle">Track your outreach performance</p>
        </div>
      </div>

      <div class="stats">
        <div class="stat-card">
          <div class="stat-value" id="stat-companies">0</div>
          <div class="stat-label">Companies</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-contacts">0</div>
          <div class="stat-label">Total Contacts</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-fu1">0</div>
          <div class="stat-label">Follow-up 1 Due</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-fu2">0</div>
          <div class="stat-label">Follow-up 2 Due</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="stat-fu3">0</div>
          <div class="stat-label">Follow-up 3 Due</div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Quick Actions</div>
        </div>
        <div class="card-body" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;">
          <button class="btn btn-primary" onclick="openAddModal()">‚ûï Add Company</button>
          <button class="btn btn-outline" onclick="openImportModal()">üì• Import CSV</button>
          <button class="btn btn-outline" onclick="downloadSampleCSV()">üìã Sample CSV</button>
          <button class="btn btn-outline" onclick="exportData()">üì§ Export</button>
        </div>
      </div>
    </div>

    <!-- All Prospects View -->
    <div id="view-all" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">All Prospects</h1>
          <p class="page-subtitle">Manage your pipeline</p>
        </div>
        <button class="btn btn-primary" onclick="openAddModal()">‚ûï Add Company</button>
      </div>

      <div class="filters">
        <div class="filters-grid">
          <div>
            <label class="filter-label">Status</label>
            <select class="form-select" id="filter-status" onchange="renderCurrentView()">
              <option value="">All</option>
              <option value="New">New</option>
              <option value="Contacted">Contacted</option>
              <option value="Replied">Replied</option>
              <option value="Booked">Booked</option>
            </select>
          </div>
          <div>
            <label class="filter-label">Priority</label>
            <select class="form-select" id="filter-priority" onchange="renderCurrentView()">
              <option value="">All</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
            </select>
          </div>
          <div>
            <label class="filter-label">Search</label>
            <input type="text" class="form-input" id="filter-search" oninput="renderCurrentView()" placeholder="Company, name...">
          </div>
        </div>

        <div class="quick-filters">
          <button class="quick-btn active" onclick="quickFilter('all')">üåç All</button>
          <button class="quick-btn" onclick="quickFilter('due-today')">‚è∞ Due Today</button>
          <button class="quick-btn" onclick="quickFilter('overdue')">üî¥ Overdue</button>
          <button class="quick-btn" onclick="quickFilter('high')">‚≠ê High Priority</button>
        </div>
      </div>

      <div id="list-all"></div>
    </div>

    <!-- Follow-up 1 View -->
    <div id="view-fu1" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">üì¨ Follow-up 1</h1>
          <p class="page-subtitle">First follow-up (3 days after contact)</p>
        </div>
      </div>
      <div id="list-fu1"></div>
    </div>

    <!-- Follow-up 2 View -->
    <div id="view-fu2" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">üì´ Follow-up 2</h1>
          <p class="page-subtitle">Second follow-up (7 days after contact)</p>
        </div>
      </div>
      <div id="list-fu2"></div>
    </div>

    <!-- Follow-up 3 View -->
    <div id="view-fu3" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">üì™ Follow-up 3</h1>
          <p class="page-subtitle">Final follow-up (14 days after contact)</p>
        </div>
      </div>
      <div id="list-fu3"></div>
    </div>

    <!-- Templates View -->
    <div id="view-templates" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">Templates</h1>
        </div>
        <button class="btn btn-primary" onclick="openTemplateModal()">‚ûï New Template</button>
      </div>
      <div id="templates-list"></div>
    </div>

    <!-- Settings View -->
    <div id="view-settings" class="view" style="display:none">
      <div class="page-header">
        <div>
          <h1 class="page-title">Settings</h1>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Follow-up Schedule</div>
        </div>
        <div class="card-body">
          <label style="display:block;margin-bottom:8px;font-weight:600">Days until first follow-up</label>
          <input type="number" class="form-input" id="settings-days" value="3" min="1" max="30" style="max-width:200px">
          <p style="margin-top:12px;font-size:14px;color:var(--text-secondary)">Schedule: FU1 at X days, FU2 at X+4, FU3 at X+11</p>
          <button class="btn btn-primary" onclick="saveSettings()" style="margin-top:20px">üíæ Save</button>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modals -->
<div class="modal" id="prospect-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Add Company</h2>
    </div>
    <div class="modal-body">
      <form id="prospect-form" onsubmit="saveProspect(event)">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
          <div>
            <label style="display:block;margin-bottom:8px;font-weight:600">Company *</label>
            <input type="text" class="form-input" id="f-company" required>
          </div>
          <div>
            <label style="display:block;margin-bottom:8px;font-weight:600">Industry</label>
            <input type="text" class="form-input" id="f-industry">
          </div>
        </div>
        
        <label style="display:block;margin-bottom:12px;font-weight:700;font-size:16px">Contacts</label>
        <div id="founders-list" style="margin-bottom:16px"></div>
        <button type="button" class="btn btn-outline btn-sm" onclick="addFounder()">+ Add Contact</button>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="document.getElementById('prospect-form').requestSubmit()">Save</button>
    </div>
  </div>
</div>

<div class="modal" id="import-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Import CSV</h2>
    </div>
    <div class="modal-body">
      <div style="border:3px dashed var(--border);border-radius:16px;padding:48px;text-align:center;cursor:pointer" onclick="document.getElementById('csv-file').click()">
        <div style="font-size:56px;margin-bottom:16px">üìÅ</div>
        <div style="font-size:18px;font-weight:700;margin-bottom:8px">Click to upload</div>
        <div style="font-size:14px;color:var(--text-secondary)">CSV or Excel file</div>
        <input type="file" id="csv-file" accept=".csv,.xlsx" style="display:none" onchange="processImport(event)">
      </div>
      <div id="import-preview" style="display:none;margin-top:24px"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" id="import-btn" style="display:none" onclick="confirmImport()">Import</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
let data = { companies: [], templates: [], settings: { followupDays: 3 } };
let currentView = 'dashboard';
let currentFilter = 'all';
let founderCount = 0;
let importData = null;

// Load/Save
function load() {
  const saved = localStorage.getItem('outreach-pro-v1');
  if (saved) data = JSON.parse(saved);
  if (!data.templates || data.templates.length === 0) {
    data.templates = [
      { id: '1', name: 'Initial', subject: 'Save 70% - {{company}}', body: 'Hi {{name}},\n\nStep2Dev helps EU startups save 70%+ on engineering.\n\nInterested?' },
      { id: '2', name: 'Follow-up 1', subject: 'Re: {{company}}', body: 'Hi {{name}},\n\nFollowing up. Still hiring?' },
      { id: '3', name: 'Follow-up 2', subject: 'ROI for {{company}}', body: 'Hi {{name}},\n\nQuick 10min call?' }
    ];
  }
}

function save() {
  localStorage.setItem('outreach-pro-v1', JSON.stringify(data));
}

// Views
function switchView(view) {
  currentView = view;
  document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('view-' + view).style.display = 'block';
  event.target.classList.add('active');
  renderCurrentView();
}

function renderCurrentView() {
  updateStats();
  if (currentView === 'all') renderList('all');
  else if (currentView === 'fu1') renderList('fu1');
  else if (currentView === 'fu2') renderList('fu2');
  else if (currentView === 'fu3') renderList('fu3');
  else if (currentView === 'templates') renderTemplates();
}

// Stats
function updateStats() {
  const today = new Date().toISOString().split('T')[0];
  let totalContacts = 0;
  let fu1 = 0, fu2 = 0, fu3 = 0;
  
  data.companies.forEach(c => {
    c.founders.forEach(f => {
      totalContacts++;
      if (f.scheduledFollowups) {
        if (f.nextFollowupNumber === 1 && f.followupDate <= today) fu1++;
        if (f.nextFollowupNumber === 2 && f.followupDate <= today) fu2++;
        if (f.nextFollowupNumber === 3 && f.followupDate <= today) fu3++;
      }
    });
  });
  
  document.getElementById('stat-companies').textContent = data.companies.length;
  document.getElementById('stat-contacts').textContent = totalContacts;
  document.getElementById('stat-fu1').textContent = fu1;
  document.getElementById('stat-fu2').textContent = fu2;
  document.getElementById('stat-fu3').textContent = fu3;
  document.getElementById('nav-all').textContent = data.companies.length;
  document.getElementById('nav-fu1').textContent = fu1;
  document.getElementById('nav-fu2').textContent = fu2;
  document.getElementById('nav-fu3').textContent = fu3;
}

// Render Lists
function renderList(type) {
  const today = new Date().toISOString().split('T')[0];
  let filtered = [];
  
  data.companies.forEach(c => {
    c.founders.forEach((f, i) => {
      let match = false;
      
      if (type === 'all') match = true;
      else if (type === 'fu1' && f.nextFollowupNumber === 1 && f.followupDate <= today) match = true;
      else if (type === 'fu2' && f.nextFollowupNumber === 2 && f.followupDate <= today) match = true;
      else if (type === 'fu3' && f.nextFollowupNumber === 3 && f.followupDate <= today) match = true;
      
      // Apply filters
      const statusFilter = document.getElementById('filter-status')?.value;
      const priorityFilter = document.getElementById('filter-priority')?.value;
      const searchFilter = document.getElementById('filter-search')?.value.toLowerCase() || '';
      
      if (statusFilter && c.status !== statusFilter) match = false;
      if (priorityFilter && c.priority !== priorityFilter) match = false;
      if (searchFilter) {
        const searchText = `${c.companyName} ${f.name} ${f.email}`.toLowerCase();
        if (!searchText.includes(searchFilter)) match = false;
      }
      
      // Quick filters
      if (currentFilter === 'due-today' && f.followupDate !== today) match = false;
      if (currentFilter === 'overdue' && (!f.followupDate || f.followupDate >= today)) match = false;
      if (currentFilter === 'high' && c.priority !== 'High') match = false;
      
      if (match) filtered.push({ company: c, founder: f, founderIdx: i });
    });
  });
  
  const container = document.getElementById('list-' + type);
  if (filtered.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:60px;color:var(--text-secondary)"><div style="font-size:64px;margin-bottom:16px">üì≠</div><div style="font-size:20px;font-weight:700">No contacts</div></div>';
    return;
  }
  
  container.innerHTML = filtered.map(item => {
    const f = item.founder;
    const c = item.company;
    const isDue = f.followupDate && f.followupDate <= today;
    
    let scheduleHtml = '';
    if (f.scheduledFollowups) {
      scheduleHtml = '<div class="followup-schedule"><strong>üìÖ Schedule:</strong><br>';
      f.scheduledFollowups.forEach(fu => {
        const status = fu.sent ? 'fu-sent' : (fu.date <= today ? 'fu-due' : 'fu-scheduled');
        const label = fu.sent ? '‚úÖ' : (fu.date <= today ? '‚è∞' : 'üìÖ');
        scheduleHtml += `<span class="followup-item ${status}">${label} FU${fu.number}: ${fu.date}</span>`;
      });
      scheduleHtml += '</div>';
    }
    
    const btnText = !f.contacted ? 'üìß Send Email' : `üì¨ Send Follow-up ${f.nextFollowupNumber || ''}`;
    
    return `
      <div class="contact-card" style="${isDue ? 'border-color:var(--warning);border-width:3px' : ''}">
        <div class="contact-header">
          <div>
            <div class="contact-name">${f.name} at ${c.companyName}</div>
            <div style="font-size:12px;color:var(--text-secondary)">${f.title || ''}</div>
          </div>
          ${isDue ? '<span style="background:var(--warning);color:white;padding:4px 12px;border-radius:8px;font-size:12px;font-weight:700">‚è∞ DUE</span>' : ''}
        </div>
        <div class="contact-email">${f.email}</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn btn-${isDue ? 'warning' : 'primary'} btn-sm" onclick="sendEmail('${c.id}', ${item.founderIdx})">${btnText}</button>
          ${f.linkedin ? `<button class="btn btn-outline btn-sm" onclick="window.open('${f.linkedin}')">üîó</button>` : ''}
        </div>
        ${scheduleHtml}
      </div>
    `;
  }).join('');
}

// Quick Filters
function quickFilter(type) {
  currentFilter = type;
  document.querySelectorAll('.quick-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  renderCurrentView();
}

// Add/Edit
function openAddModal() {
  founderCount = 0;
  document.getElementById('prospect-form').reset();
  document.getElementById('founders-list').innerHTML = '';
  addFounder();
  document.getElementById('prospect-modal').classList.add('active');
}

function addFounder() {
  const id = founderCount++;
  document.getElementById('founders-list').insertAdjacentHTML('beforeend', `
    <div style="border:2px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px;background:var(--bg-hover)">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <input type="text" class="form-input" id="fn-${id}" placeholder="Name *" required>
        <input type="email" class="form-input" id="fe-${id}" placeholder="Email *" required>
        <input type="text" class="form-input" id="ft-${id}" placeholder="Title">
        <input type="url" class="form-input" id="fl-${id}" placeholder="LinkedIn">
      </div>
    </div>
  `);
}

function saveProspect(e) {
  e.preventDefault();
  
  const founders = [];
  for (let i = 0; i < founderCount; i++) {
    const name = document.getElementById(`fn-${i}`)?.value;
    const email = document.getElementById(`fe-${i}`)?.value;
    if (name && email) {
      founders.push({
        name,
        email,
        title: document.getElementById(`ft-${i}`)?.value || '',
        linkedin: document.getElementById(`fl-${i}`)?.value || '',
        contacted: false,
        contactedDate: null,
        followupDate: null,
        nextFollowupNumber: null,
        followupCount: 0,
        scheduledFollowups: []
      });
    }
  }
  
  data.companies.push({
    id: Date.now().toString(),
    companyName: document.getElementById('f-company').value,
    industry: document.getElementById('f-industry').value || '',
    priority: 'Medium',
    status: 'New',
    founders,
    createdAt: new Date().toISOString()
  });
  
  save();
  closeModal();
  renderCurrentView();
  showToast('‚úÖ Company added!');
}

// Email
function sendEmail(companyId, founderIdx) {
  const company = data.companies.find(c => c.id === companyId);
  const founder = company.founders[founderIdx];
  
  if (!founder.contacted) {
    // Mark as contacted & schedule follow-ups
    founder.contacted = true;
    founder.contactedDate = new Date().toISOString().split('T')[0];
    
    const days = data.settings.followupDays || 3;
    const schedule = [
      { number: 1, days: days },
      { number: 2, days: days + 4 },
      { number: 3, days: days + 11 }
    ];
    
    founder.scheduledFollowups = schedule.map(s => {
      const date = new Date();
      date.setDate(date.getDate() + s.days);
      return { number: s.number, date: date.toISOString().split('T')[0], sent: false };
    });
    
    founder.followupDate = founder.scheduledFollowups[0].date;
    founder.nextFollowupNumber = 1;
    
    save();
    showToast('‚úÖ Contacted! 3 follow-ups scheduled');
  } else {
    // Send follow-up
    const fuNum = founder.nextFollowupNumber;
    if (founder.scheduledFollowups && founder.scheduledFollowups[fuNum - 1]) {
      founder.scheduledFollowups[fuNum - 1].sent = true;
    }
    founder.followupCount++;
    
    if (fuNum < 3) {
      founder.nextFollowupNumber = fuNum + 1;
      founder.followupDate = founder.scheduledFollowups[fuNum].date;
    } else {
      founder.nextFollowupNumber = null;
      founder.followupDate = null;
    }
    
    save();
    showToast(`‚úÖ Follow-up ${fuNum} sent!`);
  }
  
  // Open Gmail
  const template = data.templates[founder.contacted ? founder.followupCount : 0] || data.templates[0];
  const subject = template.subject.replace(/\{\{company\}\}/g, company.companyName).replace(/\{\{name\}\}/g, founder.name);
  const body = template.body.replace(/\{\{company\}\}/g, company.companyName).replace(/\{\{name\}\}/g, founder.name);
  window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${founder.email}&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
  
  renderCurrentView();
}

// Import/Export
function downloadSampleCSV() {
  const csv = `Company,Industry,Founder Name,Founder Email,Founder Title,Founder LinkedIn
Acme Corp,SaaS,John Doe,john@acme.com,CEO,https://linkedin.com/in/johndoe
Acme Corp,SaaS,Jane Smith,jane@acme.com,CTO,https://linkedin.com/in/janesmith`;
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'sample.csv';
  a.click();
}

function openImportModal() {
  document.getElementById('import-modal').classList.add('active');
}

function processImport(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet);
    
    const companies = {};
    rows.forEach(row => {
      const company = row.Company || row.company;
      if (!company) return;
      
      if (!companies[company]) {
        companies[company] = {
          companyName: company,
          industry: row.Industry || '',
          priority: 'Medium',
          status: 'New',
          founders: []
        };
      }
      
      const name = row['Founder Name'] || row['founder name'] || row.Name || row.name;
      const email = row['Founder Email'] || row['founder email'] || row.Email || row.email;
      if (name && email) {
        companies[company].founders.push({
          name,
          email,
          title: row['Founder Title'] || '',
          linkedin: row['Founder LinkedIn'] || '',
          contacted: false,
          scheduledFollowups: []
        });
      }
    });
    
    importData = Object.values(companies).map(c => ({
      ...c,
      id: Date.now().toString() + Math.random(),
      createdAt: new Date().toISOString()
    }));
    
    document.getElementById('import-preview').innerHTML = `<strong>${importData.length} companies ready to import</strong>`;
    document.getElementById('import-preview').style.display = 'block';
    document.getElementById('import-btn').style.display = 'inline-flex';
    document.getElementById('import-btn').innerHTML = `Import ${importData.length} Companies`;
  };
  reader.readAsArrayBuffer(file);
}

function confirmImport() {
  if (importData) {
    data.companies.push(...importData);
    save();
    closeModal();
    renderCurrentView();
    showToast(`‚úÖ Imported ${importData.length} companies!`);
    importData = null;
  }
}

function exportData() {
  const rows = [['Company', 'Industry', 'Founder Name', 'Email', 'Title', 'LinkedIn', 'Contacted', 'Follow-up Date']];
  data.companies.forEach(c => {
    c.founders.forEach(f => {
      rows.push([c.companyName, c.industry, f.name, f.email, f.title, f.linkedin, f.contacted ? 'Yes' : 'No', f.followupDate || '']);
    });
  });
  
  const ws = XLSX.utils.aoa_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Prospects');
  XLSX.writeFile(wb, 'outreach.xlsx');
}

// Templates
function renderTemplates() {
  const html = data.templates.map(t => `
    <div class="card">
      <div class="card-header">
        <div class="card-title">${t.name}</div>
      </div>
      <div class="card-body">
        <div style="font-weight:600;margin-bottom:8px">Subject:</div>
        <div style="margin-bottom:16px;color:var(--text-secondary)">${t.subject}</div>
        <div style="font-weight:600;margin-bottom:8px">Body:</div>
        <div style="white-space:pre-wrap;color:var(--text-secondary)">${t.body}</div>
      </div>
    </div>
  `).join('');
  document.getElementById('templates-list').innerHTML = html;
}

// Settings
function saveSettings() {
  data.settings.followupDays = parseInt(document.getElementById('settings-days').value) || 3;
  save();
  showToast('‚úÖ Settings saved!');
}

// Utils
function closeModal() {
  document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Init
load();
updateStats();
renderTemplates();
document.getElementById('settings-days').value = data.settings.followupDays || 3;
</script>

</body>
</html>
